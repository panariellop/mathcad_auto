<h1 style = "text-align:center">Mathcad Anchorage Automation Software Developer's Documentation</h1>
<p>Note: This is the developer documentation file. Use this as a reference to how the program is constructed. </p>

<h3>Technologies Used:</h3>
	<ol>
		<li>Python is the programming language of choice</li>
		<li>PySimpleGUI : used to render the graphical user interface. <a target=blank href = "https://pysimplegui.readthedocs.io/en/latest/">Documentation</a></li>
		<li>MathcadPy : wrapper written in python used to access the Mathcad api. <a target=blank href = "https://github.com/MattWoodhead/MathcadPy/blob/master/MathcadPy/_application.py">Documentation</a> </li>
		<li>Openpyxl : used to interface with the excel documents. <a target=blank href = "https://openpyxl.readthedocs.io/en/stable/">Documentation</a> </li>
		<li>Nuitka : used to package the application as an executable. <a target=blank href = "https://nuitka.net/doc/user-manual.html">Documentation</a></li>
		<li>Look in ~./dist/requirements.txt to view all the dependencies</li>
		<li>Look in ~./dist/info.txt for more information on how to package the application and how to re-create the python virutal environment.</li>
	</ol>
<h3>Flowchart:</h3>
<img src = "./dist/documentation/component_flowchart.png" style = "width: 50%; margin:0 auto 0 auto" />

<h3>Outline: </h3>
	<ol>
		<li>Datatypes and storage of data</li>
		<li>Connection between Excel document and Mathcad</li>
		<li>Rendering to the GUI </li>
	</ol>

<h3>Documentation:</h3>

<h4 style = "text-align:center">Datypes and Storage of Data</h4>
<p>
	Equipment Class: (stores all the equipment from the excel file)
	<div style = "margin-left: 20px">
	<p>Class variables:</p>
	<ul>
		<li><b>self.items</b> = list()</li> <p>List of all the equipment in the excel file, stored as individual dictionaries.</p>
		<li><b>self.cur_index </b>= 0 </li> <p>The current index of the equipment that the user is viewing in the GUI</p>
		<li><b>self.length </b>= 0 </li> <p> Holds the length of self.items</p>
		<li><b>self.fields </b>= list()</li> <p>A list of all the elements from the header row from the excel document</p>
		<li><b>self.names</b> = list()</li><p>A list of all the equipment names from the excel document</p>
		<li><b>self.inputs</b> = list()</li> <p>A list of all the inputs from the header row in the excel document</p>
	</ul>
	<p>Class methods:</p>
	<ul>
		<li><b>append(self, to_append:dict)</b> Takes in a dict as an argument</li><p>Appends self.items with the new equipment dictionary, appends self.names, appends self.inputs</p>
		<li><b>next_index(self)</b> No arguments<p>Increments the value of self.cur_index</p></li>
		<li><b>prev_index(self)</b> No arguments<p>Decriments the value of self.cur_index</p></li>
	</ul>
	</div>
</p>
<p>
	Outputs Class: (stores the values of the outputs when the user decides to preview the output variables from the Mathcad file)
	<div style = "margin-left: 20px">
	<p>Class variables:</p>
	<ul>
		<li><b>self.items = list()</b></li><p>Follows the format:</br>
		<i>alias, [value, unit, power]</i></br>
		['f_p_max_output', [408.81554560308007, 'kg', 0]],</br>
		['f_p_min_output', [76.65291480057748, 'kg', 0]],</br>
		['f_p_tot_output', [76.65291480057748, 'kg', 0]],</br>...</p>
	</ul>
	<p>Class methods:</p>
	<ul>
		<li><b>append(self, to_append)</b>Takes tuple or list argument</li><p>Converts to_append to array and appends self.items</p>
		<li><b>clear(self)</b></li><p>Clears self.items</p>
		<li><b>display(self)->list</b> No arguments</li><p>Returns a list of variables and values that is easier to display in the GUI. Rounds decimals to 2 digits. </br>Ex: [ 'f_p_tot_output = 408.82 kg', 'f_p_min_output = 76.65 kg', ...]
	</ul>
	</div>
</p>

<h4 style = "text-align:center">Excel and Mathcad</h4>
<div style = "margin-left:auto; margin-right:auto;width:80vw; padding:0 20px 0 20px;">
<p>
	The MathcadPy library is used as a wrapper that allows you to access all of the mathcad api endpoints from the comfort of Python. You can read more about the Mathcad API <a target = blank href = "https://support.ptc.com/help/mathcad/r7.0/en/index.html#page/PTC_Mathcad_Help%2Fmathcad_and_automation_api.html%23">here</a>. The API allows you to modify and change Mathcad Prime files. Despite PTC's documenation, you cannot print documents.
</p>
<p>
	The function <b>get_eqpt_from_xl(filepath:str)->Equipment</b> takes in the filepath of the input excel file and returns the Equipment object. This function is executed right after the choose files window is closed.

</p>
<p>The excel table looks like the one below:</p>
<div class = "excel_table">
	<table style = "border: 1px solid black;" class="table table-bordered table-hover table-condensed">
	<thead><tr><th title="Field #1">eqpt_name</th>
	<th title="Field #2">mounting_location</th>
	<th title="Field #3">tags</th>
	<th title="Field #4">w_p_input(lb)</th>
	<th title="Field #5">s_ds_input</th>
	<th title="Field #6">a_p_input</th>
	<th title="Field #7">r_p_input</th>
	<th title="Field #8">i_p_input</th>
	<th title="Field #9">z_input</th>
	<th title="Field #10">h_input</th>
	<th title="Field #11">capital_a_input(in)</th>
	<th title="Field #12">capital_b_input(in)</th>
	<th title="Field #13">a_input(in)</th>
	<th title="Field #14">b_input(in)</th>
	<th title="Field #15">capital_h_input(ft)</th>
	<th title="Field #16">omega_input</th>
	<th title="Field #17">factor_input</th>
	</tr></thead>
	<tbody><tr>
	<td>Anesthesia Machine </td>
	<td>Wall, Floor</td>
	<td>Medical, ICU, something</td>
	<td align="right">335</td>
	<td align="right">1.121</td>
	<td>1</td>
	<td align="right">2.5</td>
	<td align="right">1.5</td>
	<td align="right">0</td>
	<td align="right">75</td>
	<td align="right">30</td>
	<td align="right">20.5</td>
	<td align="right">1.5</td>
	<td align="right">-1.5</td>
	<td align="right">74.25</td>
	<td align="right">2.5</td>
	<td align="right">0.666666</td>
	</tr>
	<tr>
	<td>Warming Cabinet</td>
	<td>Floor</td>
	<td>Medical</td>
	<td align="right">137</td>
	<td align="right">1.121</td>
	<td>1</td>
	<td align="right">2.5</td>
	<td align="right">1.5</td>
	<td align="right">3</td>
	<td align="right">75</td>
	<td align="right">30</td>
	<td align="right">21.5</td>
	<td align="right">1.5</td>
	<td align="right">-3.5</td>
	<td align="right">24.5</td>
	<td align="right">2.5</td>
	<td align="right">0.666666</td>
	</tr>
	<tr>
	<td>Surgical Scrub Sink</td>
	<td>Wall</td>
	<td>Medical</td>
	<td align="right">295</td>
	<td align="right">1.121</td>
	<td>1</td>
	<td align="right">2.5</td>
	<td align="right">1.5</td>
	<td align="right">4</td>
	<td align="right">75</td>
	<td align="right">64</td>
	<td align="right">28</td>
	<td align="right">1.5</td>
	<td align="right">-3.5</td>
	<td align="right">39.5</td>
	<td align="right">2.5</td>
	<td align="right">0.666666</td>
	</tr>
	<tr>
	<td>Retractable Ceiling Column</td>
	<td>Ceiling</td>
	<td>Medical</td>
	<td align="right">800</td>
	<td align="right">1.121</td>
	<td>1</td>
	<td align="right">2.5</td>
	<td align="right">1.5</td>
	<td align="right">15</td>
	<td align="right">75</td>
	<td align="right"></td>
	<td align="right"></td>
	<td align="right">14</td>
	<td align="right">14</td>
	<td align="right">45</td>
	<td align="right">2.5</td>
	<td align="right">0.666666</td>
	</tr>
	</tbody></table>
</div>

<p>
	The function <b>pre_generate_report(equipment:Equipment, files, generating_multiple_reports = False)</b> acts as a pre-fight test. It checks if the proper template is given for the equipment and passes the equipment and a uniquely generated filename to the <b>generate_report</b> function. The function <b>generate_report(cur_eqpt, equipment:Equipment, file_name:str, template_file:str, files, debug = False)->bool</b> connects to the Mathcad API, opens the template file specific to the mounting location, updates the input values specific to the equipment, and then saves the document. If generateing multiple reports, multithreading is used to speed up the process. Currently 4 threads are being used, but feel free to increase this number if the workflow demands more throughput. This variable is called <b>num_threads</b> in the event <b>generate_report_for_all</b>.
</p>
<p>
	The function <b>mathcad_calculate(eqpt, files, debug = False)</b> allows the user to preview the Mathcad calculation output. It duplicates the template file into a temp file, takes the inputs and waits for the outputs to generate. It then deletes the temp file when finished. It returns a dictionary with the output values. The debug variable changes if Mathcad will display the windows being edited or not. When debug = False, no window is shown, when debug = True, windows are shown.  
</p>
</div>

<h4 style = "text-align:center">Rendering to the GUI</h4>
<div style = "margin-left:auto; margin-right:auto;width:80vw; padding:0 20px 0 20px;">
<p>
	Choose equipment:   Once the user has input the excel file they want to read from, the program extracts all information in the <b>get_eqpt_from_xl</b> function and places all the equipment names in the Choose Equipment column.
</p>
<p>
	Inputs:   Once we get the Equipment from the <b>get_eqpt_from_xl</b> function, we can then render it to the input fields in the GUI.
</p>
<p>
	Outputs:  If the user clicks the <b>Preview Calculation Outputs</b> button, the inputs from the current equipment being used is sent to the template corresponding to the correct mounting location and the output fields are gathered via the <b>mathcad_calculate</b> function. The outputs are saved in the Outputs class and the information is displayed in the GUI.
</p>
<p>
	Preview Images:  The user has the option to include preview images that correspond to the mounting locations. The images must be included in the excel document. Use the <b>example_sheet.xlsx</b> as a template. Images muse be .png or .jpg or .jpeg. The images are gathered from the excel sheet using the <b>get_images_from_xl(self, num_images:int)</b> function. Images are stored as binaries. When the user views a different equipment, the image corresponding to the mounting location is loaded into the Image Preview section of the GUI. Use ./dist/img_to_b64.py to convert images from .png/.jpg to binaries. It provides a python file called output.py with the binaries stored in variables. Preview images are automatically converted to binaries in <b>get_images_from_xl</b>.
</p>

</div>
<h4 style = "text-align:center">Saving to the Database</h4>
<div style = "margin-left:auto; margin-right:auto;width:80vw; padding:0 20px 50px 20px;">
<p>
	Saving to Database:   The database is a .csv file which holds some important information about generated repors. The function <b>save_to_csv</b> is used. When the user decides to save the report to the database, they are saving the equipment name, mounting location, tags, and the generated report's unique filename. The user can choose a specific database to save to, or it will save to the default database located in the mathcad_automation_output folder.
</p>
<p>
	The table looks like the one below:
</p>
<div class = "csv_table">
	<table style = "border: 1px solid black" class="table table-bordered table-hover table-condensed">
	<thead><tr><th title="Field #1">Date</th>
	<th title="Field #2">Tags</th>
	<th title="Field #3">Name</th>
	<th title="Field #4">Mounting Location</th>
	<th title="Field #5">File Name</th>
	</tr></thead>
	<tbody><tr>
	<td>2021-06-30</td>
	<td>MEDICAL</td>
	<td>RETRACTABLE CEILING COLUMN</td>
	<td>CEILING</td>
	<td>test.mcdx</td>
	</tr>
	<tr>
	<td>2021-06-30</td>
	<td>MEDICAL</td>
	<td>RETRACTABLE CEILING COLUMN</td>
	<td>CEILING</td>
	<td>Retractable_Ceiling_Column_report_MKDXSPPA.mcdx</td>
	</tr>
	<tr>
	<td>2021-06-30</td>
	<td>MEDICAL</td>
	<td>SURGICAL SCRUB SINK</td>
	<td>WALL</td>
	<td>Surgical_Scrub_Sink_report_YILGRVNK.mcdx</td>
	</tr>
	<tr>
	<td>2021-06-30</td>
	<td>MEDICAL, ICU</td>
	<td>ANESTHESIA MACHINE </td>
	<td>WALL, FLOOR</td>
	<td>Anesthesia_Machine__report_WWHGKNKN.mcdx</td>
	</tr>
	<tr>
	<td>2021-06-30</td>
	<td>MEDICAL</td>
	<td>WARMING CABINET</td>
	<td>FLOOR</td>
	<td>Warming_Cabinet_report_WSIDKRWK.mcdx</td>
	</tr>
	<tr>
	<td>2021-07-01</td>
	<td>MEDICAL</td>
	<td>RETRACTABLE CEILING COLUMN</td>
	<td>CEILING</td>
	<td>testing.mcdx</td>
	</tr>
	</tbody></table>
</div>
</div>
